<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CV Analysis - Vision.AI</title>
    <link rel="stylesheet" href="../assets/css/main.css">
    <link rel="stylesheet" href="../assets/css/components.css">
    <style>
        .analysis-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
        }

        .page-header {
            margin-bottom: 2rem;
        }

        .page-title {
            font-size: 2rem;
            font-weight: bold;
            color: #1f2937;
            margin-bottom: 0.5rem;
        }

        .page-subtitle {
            color: #6b7280;
            font-size: 1rem;
        }

        .analysis-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin-bottom: 2rem;
        }

        @media (max-width: 968px) {
            .analysis-grid {
                grid-template-columns: 1fr;
            }
        }

        .card {
            background: white;
            padding: 2rem;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .card-title {
            font-size: 1.25rem;
            font-weight: bold;
            color: #1f2937;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .data-row {
            display: flex;
            justify-content: space-between;
            padding: 1rem 0;
            border-bottom: 1px solid #f3f4f6;
        }

        .data-row:last-child {
            border-bottom: none;
        }

        .data-label {
            font-weight: 500;
            color: #6b7280;
        }

        .data-value {
            color: #1f2937;
            font-weight: 600;
        }

        .skills-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 0.75rem;
            margin-top: 1rem;
        }

        .skill-badge {
            padding: 0.75rem 1rem;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 8px;
            text-align: center;
            font-weight: 500;
            font-size: 0.875rem;
        }

        .experience-item {
            padding: 1.5rem;
            background: #f9fafb;
            border-radius: 8px;
            margin-bottom: 1rem;
        }

        .experience-title {
            font-weight: bold;
            color: #1f2937;
            margin-bottom: 0.25rem;
        }

        .experience-company {
            color: #667eea;
            font-weight: 500;
            margin-bottom: 0.5rem;
        }

        .experience-duration {
            color: #6b7280;
            font-size: 0.875rem;
            margin-bottom: 0.75rem;
        }

        .experience-description {
            color: #4b5563;
            font-size: 0.875rem;
            line-height: 1.6;
        }

        .role-card {
            padding: 1.5rem;
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            margin-bottom: 1rem;
            transition: all 0.3s;
            cursor: pointer;
        }

        .role-card:hover {
            border-color: #667eea;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2);
            transform: translateY(-2px);
        }

        .role-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 1rem;
        }

        .role-title {
            font-size: 1.25rem;
            font-weight: bold;
            color: #1f2937;
        }

        .match-badge {
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-weight: bold;
            font-size: 0.875rem;
        }

        .match-high {
            background: #d1fae5;
            color: #065f46;
        }

        .match-medium {
            background: #fef3c7;
            color: #92400e;
        }

        .match-low {
            background: #fee2e2;
            color: #991b1b;
        }

        .role-description {
            color: #6b7280;
            font-size: 0.875rem;
            line-height: 1.6;
            margin-bottom: 1rem;
        }

        .role-requirements {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .requirement-tag {
            padding: 0.25rem 0.75rem;
            background: #f3f4f6;
            color: #4b5563;
            border-radius: 12px;
            font-size: 0.75rem;
        }

        .requirement-tag.matched {
            background: #d1fae5;
            color: #065f46;
        }

        .stats-bar {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .stat-box {
            flex: 1;
            padding: 1.5rem;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 12px;
            text-align: center;
        }

        .stat-number {
            font-size: 2.5rem;
            font-weight: bold;
            margin-bottom: 0.25rem;
        }

        .stat-label {
            font-size: 0.875rem;
            opacity: 0.9;
        }

        .loading {
            text-align: center;
            padding: 3rem;
            color: #6b7280;
        }

        .spinner {
            border: 3px solid #f3f4f6;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        .empty-state {
            text-align: center;
            padding: 3rem;
            color: #6b7280;
        }

        .empty-state-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
        }

        .btn-upload {
            padding: 0.75rem 1.5rem;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            margin-top: 1rem;
        }

        .btn-upload:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .full-width {
            grid-column: 1 / -1;
        }
    </style>
</head>

<body>
    <div class="analysis-container">
        <!-- Header -->
        <div class="page-header">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <div>
                    <h1 class="page-title">üìä CV Analysis & Job Recommendations</h1>
                    <p class="page-subtitle">AI-powered analysis of your CV with personalized job role suggestions</p>
                </div>

                <!-- Automate Everything Toggle -->
                <div style="display: flex; flex-direction: column; align-items: flex-end; gap: 0.5rem;">
                    <div style="display: flex; align-items: center; gap: 1rem; padding: 1rem 1.5rem; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 12px; color: white; cursor: pointer;"
                        onclick="toggleAutomation()">
                        <div>
                            <div style="font-weight: bold; font-size: 1rem;">ü§ñ Automate Everything</div>
                            <div style="font-size: 0.75rem; opacity: 0.9;" id="automationStatus">Click to enable full
                                automation</div>
                        </div>
                        <div id="automationToggle"
                            style="position: relative; width: 60px; height: 30px; background: rgba(255,255,255,0.3); border-radius: 15px; transition: all 0.3s;">
                            <div id="automationSlider"
                                style="position: absolute; top: 3px; left: 3px; width: 24px; height: 24px; background: white; border-radius: 50%; transition: all 0.3s;">
                            </div>
                        </div>
                    </div>
                    <div id="premiumBadge"
                        style="display: none; padding: 0.5rem 1rem; background: #fbbf24; color: #78350f; border-radius: 8px; font-size: 0.875rem; font-weight: bold;">
                        ‚≠ê Premium Feature
                    </div>
                </div>
            </div>
        </div>

        <!-- Automation Settings Panel (Hidden by default) -->
        <div id="automationPanel"
            style="display: none; background: white; padding: 2rem; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); margin-bottom: 2rem;">
            <h3 style="font-size: 1.25rem; font-weight: bold; margin-bottom: 1rem;">‚öôÔ∏è Automation Settings</h3>
            <p style="color: #6b7280; margin-bottom: 1.5rem;">Configure how the system automatically applies to jobs on
                your behalf</p>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; margin-bottom: 1.5rem;">
                <div>
                    <label style="display: block; font-weight: 500; margin-bottom: 0.5rem;">Max Applications Per
                        Day</label>
                    <input type="range" min="1" max="10" value="5" id="maxAppsSlider" style="width: 100%;"
                        oninput="updateSliderValue('maxApps', this.value)">
                    <div style="text-align: center; margin-top: 0.5rem; font-weight: bold; color: #667eea;">
                        <span id="maxAppsValue">5</span> applications/day
                    </div>
                </div>
                <div>
                    <label style="display: block; font-weight: 500; margin-bottom: 0.5rem;">Minimum Match Score</label>
                    <input type="range" min="50" max="90" value="70" id="minScoreSlider" style="width: 100%;"
                        oninput="updateSliderValue('minScore', this.value)">
                    <div style="text-align: center; margin-top: 0.5rem; font-weight: bold; color: #667eea;">
                        <span id="minScoreValue">70</span>% minimum
                    </div>
                </div>
            </div>

            <div style="background: #f9fafb; padding: 1.5rem; border-radius: 8px; margin-bottom: 1.5rem;">
                <h4 style="font-weight: bold; margin-bottom: 0.75rem;">What Will Be Automated:</h4>
                <ul style="list-style: none; padding: 0; margin: 0;">
                    <li style="padding: 0.5rem 0; color: #4b5563;">‚úÖ AI finds matching jobs (based on your CV)</li>
                    <li style="padding: 0.5rem 0; color: #4b5563;">‚úÖ Generates custom CV for each job</li>
                    <li style="padding: 0.5rem 0; color: #4b5563;">‚úÖ Writes personalized cover letters</li>
                    <li style="padding: 0.5rem 0; color: #4b5563;">‚úÖ Submits applications automatically</li>
                    <li style="padding: 0.5rem 0; color: #4b5563;">‚úÖ Monitors email for responses</li>
                    <li style="padding: 0.5rem 0; color: #4b5563;">‚úÖ Updates application status</li>
                    <li style="padding: 0.5rem 0; color: #4b5563;">‚úÖ Sends you notifications</li>
                </ul>
            </div>

            <button onclick="saveAutomationSettings()"
                style="padding: 0.75rem 2rem; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 8px; font-weight: 500; cursor: pointer;">
                Save Settings & Start Automation
            </button>
        </div>

        <!-- Stats Bar -->
        <div class="stats-bar" id="statsBar" style="display: none;">
            <div class="stat-box">
                <div class="stat-number" id="totalSkills">0</div>
                <div class="stat-label">Skills Identified</div>
            </div>
            <div class="stat-box">
                <div class="stat-number" id="yearsExp">0</div>
                <div class="stat-label">Years Experience</div>
            </div>
            <div class="stat-box">
                <div class="stat-number" id="matchingRoles">0</div>
                <div class="stat-label">Matching Roles</div>
            </div>
        </div>

        <!-- Main Grid -->
        <div class="analysis-grid">
            <!-- Personal Information -->
            <div class="card">
                <h2 class="card-title">üë§ Personal Information</h2>
                <div id="personalInfo" class="loading">
                    <div class="spinner"></div>
                    <p>Loading CV data...</p>
                </div>
            </div>

            <!-- Professional Summary -->
            <div class="card">
                <h2 class="card-title">üìù Professional Summary</h2>
                <div id="professionalSummary" class="loading">
                    <div class="spinner"></div>
                    <p>Analyzing...</p>
                </div>
            </div>

            <!-- Skills -->
            <div class="card full-width">
                <h2 class="card-title">üéØ Skills & Expertise</h2>
                <div id="skillsSection" class="loading">
                    <div class="spinner"></div>
                    <p>Extracting skills...</p>
                </div>
            </div>

            <!-- Experience -->
            <div class="card full-width">
                <h2 class="card-title">üíº Work Experience</h2>
                <div id="experienceSection" class="loading">
                    <div class="spinner"></div>
                    <p>Loading experience...</p>
                </div>
            </div>
        </div>

        <!-- Recommended Job Roles -->
        <div class="card">
            <h2 class="card-title">üéØ Recommended Job Roles Based on Your CV</h2>
            <div id="recommendedRoles" class="loading">
                <div class="spinner"></div>
                <p>Analyzing your profile and finding matching roles...</p>
            </div>
        </div>
    </div>

    <script src="../assets/js/auth.js"></script>
    <script>
        let currentUser = null;
        let cvData = null;

        // Initialize page
        async function initializePage() {
            currentUser = await getCurrentUser();
            if (!currentUser) {
                window.location.href = '/login.html';
                return;
            }

            await loadCVAnalysis();
        }

        // Load CV analysis
        async function loadCVAnalysis() {
            try {
                const response = await fetch('/api/v1/users/me', {
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('access_token')}`
                    }
                });

                const data = await response.json();
                cvData = data.cv_parsed;

                if (!cvData || Object.keys(cvData).length === 0) {
                    showEmptyState();
                    return;
                }

                // Load all sections
                loadPersonalInfo(data);
                loadProfessionalSummary(cvData);
                loadSkills(cvData);
                loadExperience(cvData);
                loadRecommendedRoles(cvData);
                updateStats(cvData);

            } catch (error) {
                console.error('Error loading CV analysis:', error);
                showError();
            }
        }

        // Load personal information
        function loadPersonalInfo(data) {
            const html = `
                <div class="data-row">
                    <span class="data-label">Full Name</span>
                    <span class="data-value">${data.full_name || 'Not provided'}</span>
                </div>
                <div class="data-row">
                    <span class="data-label">Email</span>
                    <span class="data-value">${data.email || 'Not provided'}</span>
                </div>
                <div class="data-row">
                    <span class="data-label">Phone</span>
                    <span class="data-value">${cvData.phone || 'Not provided'}</span>
                </div>
                <div class="data-row">
                    <span class="data-label">Location</span>
                    <span class="data-value">${cvData.location || 'Not provided'}</span>
                </div>
                <div class="data-row">
                    <span class="data-label">Experience</span>
                    <span class="data-value">${cvData.years_of_experience || 0} years</span>
                </div>
                <div class="data-row">
                    <span class="data-label">Education</span>
                    <span class="data-value">${cvData.education_level || 'Not provided'}</span>
                </div>
            `;
            document.getElementById('personalInfo').innerHTML = html;
        }

        // Load professional summary
        function loadProfessionalSummary(cvData) {
            const summary = cvData.summary || cvData.professional_summary ||
                'No professional summary available. Upload your CV to get AI-generated insights.';

            document.getElementById('professionalSummary').innerHTML = `
                <p style="color: #4b5563; line-height: 1.8;">${summary}</p>
            `;
        }

        // Load skills
        function loadSkills(cvData) {
            const skills = cvData.skills || [];

            if (skills.length === 0) {
                document.getElementById('skillsSection').innerHTML = `
                    <p style="color: #6b7280;">No skills found in CV. Please upload a detailed CV.</p>
                `;
                return;
            }

            const html = `
                <div class="skills-grid">
                    ${skills.map(skill => `
                        <div class="skill-badge">${skill}</div>
                    `).join('')}
                </div>
            `;
            document.getElementById('skillsSection').innerHTML = html;
        }

        // Load experience
        function loadExperience(cvData) {
            const experience = cvData.experience || [];

            if (experience.length === 0) {
                document.getElementById('experienceSection').innerHTML = `
                    <p style="color: #6b7280;">No work experience found in CV.</p>
                `;
                return;
            }

            const html = experience.map(exp => `
                <div class="experience-item">
                    <div class="experience-title">${exp.title || exp.position || 'Position'}</div>
                    <div class="experience-company">${exp.company || 'Company'}</div>
                    <div class="experience-duration">
                        ${exp.start_date || 'Start'} - ${exp.end_date || exp.is_current ? 'Present' : 'End'}
                        ${exp.duration ? `(${exp.duration})` : ''}
                    </div>
                    <div class="experience-description">${exp.description || exp.responsibilities || ''}</div>
                </div>
            `).join('');

            document.getElementById('experienceSection').innerHTML = html;
        }

        // Load recommended roles
        async function loadRecommendedRoles(cvData) {
            // Generate role recommendations based on CV data
            const roles = generateRoleRecommendations(cvData);

            if (roles.length === 0) {
                document.getElementById('recommendedRoles').innerHTML = `
                    <p style="color: #6b7280; text-align: center;">
                        No role recommendations available. Please ensure your CV has detailed skills and experience.
                    </p>
                `;
                return;
            }

            const html = roles.map(role => {
                const matchClass = role.match >= 80 ? 'match-high' :
                    role.match >= 60 ? 'match-medium' : 'match-low';

                return `
                    <div class="role-card" onclick="searchRole('${role.title}')">
                        <div class="role-header">
                            <div class="role-title">${role.title}</div>
                            <div class="match-badge ${matchClass}">${role.match}% Match</div>
                        </div>
                        <div class="role-description">${role.description}</div>
                        <div class="role-requirements">
                            ${role.requirements.map(req => `
                                <span class="requirement-tag ${req.matched ? 'matched' : ''}">${req.skill}</span>
                            `).join('')}
                        </div>
                    </div>
                `;
            }).join('');

            document.getElementById('recommendedRoles').innerHTML = html;
        }

        // Generate role recommendations based on CV
        function generateRoleRecommendations(cvData) {
            const skills = (cvData.skills || []).map(s => s.toLowerCase());
            const experience = cvData.years_of_experience || 0;
            const currentRole = (cvData.current_role || '').toLowerCase();

            // Define role templates
            const roleTemplates = [
                {
                    title: 'Senior Software Engineer',
                    description: 'Lead development of complex software systems, mentor junior developers, and drive technical decisions.',
                    requiredSkills: ['javascript', 'python', 'java', 'react', 'node.js', 'sql', 'git'],
                    minExperience: 5
                },
                {
                    title: 'Full Stack Developer',
                    description: 'Build and maintain both frontend and backend systems, work with databases, and deploy applications.',
                    requiredSkills: ['javascript', 'react', 'node.js', 'mongodb', 'express', 'html', 'css'],
                    minExperience: 3
                },
                {
                    title: 'Frontend Developer',
                    description: 'Create responsive and interactive user interfaces using modern frameworks and best practices.',
                    requiredSkills: ['javascript', 'react', 'vue', 'angular', 'html', 'css', 'typescript'],
                    minExperience: 2
                },
                {
                    title: 'Backend Developer',
                    description: 'Design and implement server-side logic, APIs, and database systems.',
                    requiredSkills: ['python', 'java', 'node.js', 'sql', 'mongodb', 'api', 'rest'],
                    minExperience: 3
                },
                {
                    title: 'Data Scientist',
                    description: 'Analyze complex data sets, build machine learning models, and derive actionable insights.',
                    requiredSkills: ['python', 'machine learning', 'pandas', 'numpy', 'sql', 'statistics', 'tensorflow'],
                    minExperience: 2
                },
                {
                    title: 'DevOps Engineer',
                    description: 'Automate deployment processes, manage infrastructure, and ensure system reliability.',
                    requiredSkills: ['docker', 'kubernetes', 'aws', 'jenkins', 'linux', 'python', 'terraform'],
                    minExperience: 3
                },
                {
                    title: 'Product Manager',
                    description: 'Define product strategy, work with stakeholders, and guide product development.',
                    requiredSkills: ['product management', 'agile', 'analytics', 'communication', 'strategy'],
                    minExperience: 4
                },
                {
                    title: 'UI/UX Designer',
                    description: 'Design user-centered interfaces, create wireframes, and conduct user research.',
                    requiredSkills: ['figma', 'sketch', 'adobe xd', 'user research', 'prototyping', 'design'],
                    minExperience: 2
                }
            ];

            // Calculate match for each role
            const recommendations = roleTemplates.map(role => {
                const matchedSkills = role.requiredSkills.filter(req =>
                    skills.some(skill => skill.includes(req) || req.includes(skill))
                );

                const skillMatch = (matchedSkills.length / role.requiredSkills.length) * 100;
                const expMatch = experience >= role.minExperience ? 100 : (experience / role.minExperience) * 100;
                const overallMatch = Math.round((skillMatch * 0.7) + (expMatch * 0.3));

                return {
                    title: role.title,
                    description: role.description,
                    match: overallMatch,
                    requirements: role.requiredSkills.map(skill => ({
                        skill: skill,
                        matched: matchedSkills.includes(skill)
                    }))
                };
            });

            // Sort by match and return top 5
            return recommendations
                .sort((a, b) => b.match - a.match)
                .slice(0, 5);
        }

        // Update stats
        function updateStats(cvData) {
            const skills = cvData.skills || [];
            const experience = cvData.years_of_experience || 0;
            const roles = generateRoleRecommendations(cvData);

            document.getElementById('totalSkills').textContent = skills.length;
            document.getElementById('yearsExp').textContent = experience;
            document.getElementById('matchingRoles').textContent = roles.length;
            document.getElementById('statsBar').style.display = 'flex';
        }

        // Search for role
        function searchRole(roleTitle) {
            window.location.href = `/jobs?search=${encodeURIComponent(roleTitle)}`;
        }

        // Show empty state
        function showEmptyState() {
            const sections = ['personalInfo', 'professionalSummary', 'skillsSection', 'experienceSection', 'recommendedRoles'];
            sections.forEach(id => {
                document.getElementById(id).innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üìÑ</div>
                        <h3>No CV Data Available</h3>
                        <p>Upload your CV to get AI-powered analysis and job recommendations</p>
                        <button class="btn-upload" onclick="window.location.href='/profile'">
                            Upload CV
                        </button>
                    </div>
                `;
            });
        }

        // Show error
        function showError() {
            const sections = ['personalInfo', 'professionalSummary', 'skillsSection', 'experienceSection', 'recommendedRoles'];
            sections.forEach(id => {
                document.getElementById(id).innerHTML = `
                    <p style="color: #ef4444; text-align: center;">Error loading data. Please try again.</p>
                `;
            });
        }

        // Automation toggle functions
        let automationEnabled = false;

        async function toggleAutomation() {
            const toggle = document.getElementById('automationToggle');
            const slider = document.getElementById('automationSlider');
            const status = document.getElementById('automationStatus');
            const panel = document.getElementById('automationPanel');
            const badge = document.getElementById('premiumBadge');

            // Check if user has premium
            const userTier = currentUser?.subscription_tier || 'free';

            if (userTier === 'free' && !automationEnabled) {
                // Show premium required message
                badge.style.display = 'block';
                alert('‚≠ê Premium Feature\n\nFull automation requires a premium subscription.\n\nUpgrade to Premium to:\n‚úÖ Auto-apply to 5-10 jobs daily\n‚úÖ AI-generated custom CVs\n‚úÖ Personalized cover letters\n‚úÖ Save 90% of your time\n\nPrice: $29.99/month');
                window.location.href = '/pricing';
                return;
            }

            automationEnabled = !automationEnabled;

            if (automationEnabled) {
                // Enable automation
                toggle.style.background = '#10b981';
                slider.style.left = '33px';
                status.textContent = 'Automation enabled';
                panel.style.display = 'block';
            } else {
                // Disable automation
                toggle.style.background = 'rgba(255,255,255,0.3)';
                slider.style.left = '3px';
                status.textContent = 'Click to enable full automation';
                panel.style.display = 'none';

                // Disable on backend
                await disableAutomation();
            }
        }

        function updateSliderValue(type, value) {
            if (type === 'maxApps') {
                document.getElementById('maxAppsValue').textContent = value;
            } else if (type === 'minScore') {
                document.getElementById('minScoreValue').textContent = value;
            }
        }

        async function saveAutomationSettings() {
            const maxApps = parseInt(document.getElementById('maxAppsSlider').value);
            const minScore = parseInt(document.getElementById('minScoreSlider').value) / 100;

            try {
                const response = await fetch('/api/v1/auto-apply/enable', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('access_token')}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        max_daily_applications: maxApps,
                        min_match_score: minScore
                    })
                });

                if (response.ok) {
                    alert('‚úÖ Automation Enabled!\n\nThe system will now:\n‚úÖ Find matching jobs every 6 hours\n‚úÖ Generate custom CVs and cover letters\n‚úÖ Apply automatically (up to ' + maxApps + ' jobs/day)\n‚úÖ Notify you of all applications\n\nYou can relax while we work for you! üöÄ');

                    // Update UI
                    document.getElementById('automationStatus').textContent = 'Active - Applying to jobs automatically';
                } else {
                    const error = await response.json();
                    alert('Error: ' + (error.detail || 'Failed to enable automation'));
                }
            } catch (error) {
                console.error('Error saving automation settings:', error);
                alert('Error saving settings. Please try again.');
            }
        }

        async function disableAutomation() {
            try {
                await fetch('/api/v1/auto-apply/disable', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('access_token')}`
                    }
                });
                alert('Automation disabled. You can re-enable it anytime.');
            } catch (error) {
                console.error('Error disabling automation:', error);
            }
        }

        async function loadAutomationStatus() {
            try {
                const response = await fetch('/api/v1/auto-apply/status', {
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('access_token')}`
                    }
                });

                if (response.ok) {
                    const data = await response.json();
                    automationEnabled = data.enabled;

                    if (automationEnabled) {
                        const toggle = document.getElementById('automationToggle');
                        const slider = document.getElementById('automationSlider');
                        const status = document.getElementById('automationStatus');
                        const panel = document.getElementById('automationPanel');

                        toggle.style.background = '#10b981';
                        slider.style.left = '33px';
                        status.textContent = 'Active - Applying to jobs automatically';
                        panel.style.display = 'block';

                        // Load settings
                        document.getElementById('maxAppsSlider').value = data.max_daily_applications;
                        document.getElementById('maxAppsValue').textContent = data.max_daily_applications;
                        document.getElementById('minScoreSlider').value = Math.round(data.min_match_score * 100);
                        document.getElementById('minScoreValue').textContent = Math.round(data.min_match_score * 100);
                    }
                }
            } catch (error) {
                console.error('Error loading automation status:', error);
            }
        }

        // Initialize on page load
        initializePage().then(() => {
            loadAutomationStatus();
        });
    </script>
</body>

</html>